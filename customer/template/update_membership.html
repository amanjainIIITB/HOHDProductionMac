<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Welcome</title>
    </head>
    <script>
        function onload_behaviour(){
            setDate();
        }
        function validate_membership_id(){
            var memberships = {{memberships|safe}};
            var user_entered_membership_id = (document.getElementById('custID').value).toUpperCase();;
            console.log(user_entered_membership_id)
            var is_membership_exist = false;
            for(i=0; i<memberships.length; i++)
            {
                console.log(memberships[i]);
                if(user_entered_membership_id == memberships[i].custID)
                {
                    is_membership_exist = true;
                    break;
                }
            }
            if(is_membership_exist == true)
            {
                if(user_entered_membership_id == "{{custID}}"){
                    document.getElementById('membership_details').innerHTML= "";
                    document.getElementById("submit_button").disabled = false;
                }
                else
                {
                    document.getElementById('membership_details').innerHTML="This Membership ID has already been assigned to another Client, try another ID";
                    document.getElementById("submit_button").disabled = true;
                }
            }    
            else
            {
                document.getElementById('membership_details').innerHTML= "";
                document.getElementById("submit_button").disabled = false;
            }    
            if(user_entered_membership_id == ""){
                document.getElementById('membership_details').innerHTML="Membership ID can't be empty";
                document.getElementById("submit_button").disabled = true;
            }
        }

        function setDate(){
            console.log("Hello");
            var d = new Date("{{DOB}}");
            console.log(d);
            var day = d.getDate();
            if(day<=9)
                day = '0'+day;
            var month = d.getMonth()+1;
            if(month<=9)
                month = '0'+month;
            console.log();
            document.getElementById("DOB").value = d.getFullYear()+"-"+month+"-"+day;
        }
    </script>
    {% load static %}
    <style>
        .transaction{
            width:180px;
            text-align:center;
        }
        th, td {
            width:150px;
            height:40px;
        }
    </style>
    <body onload="onload_behaviour()">

        {% if messages %}
            <script>
                {% for message in messages %}
                    alert("{{ message }}");
                {% endfor %}
            </script>
        {% endif %}
        {% include 'menubar.html' with active_menubar_item="NA" %}
        <h1>Update Membership</h1>
        <form method="post" action="/client/update_membership/{{custID}}/">
            {% csrf_token %}
            <table>
                <tr>
                    <td>
                        <label for="custID">Client ID</label>
                    </td>
                    <td>
                        <input onmouseleave="validate_membership_id()" type="text" id="custID" name="custID" value="{{custID}}">
                    </td>
                </tr>
                <tr>
                    <td><span id="membership_details"></span></td>
                </tr>
                <tr>
                    <td>
                        <label for="Contact_Number">Contact_Number</label>
                    </td>
                    <td>
                        <input type="text" id="Contact_Number" name="Contact_Number" value="{{Contact_Number}}">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="Sex">Sex</label>
                    </td>
                    <td>
                        <select id="Sex" name="Sex" value="{{Sex}}">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="Name">Name</label>
                    </td>
                    <td>
                        <input type="text" id="Name" name="Name" value="{{Name}}">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="DOB">Date of Birth</label>
                    </td>
                    <td>
                        <input type="date" id="DOB" name="DOB"">
                    </td>
                </tr>
            </table>
            <input type="submit" id="submit_button" value="Submit">
        </form>
    </body>
</html>
